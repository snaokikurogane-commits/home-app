<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±±è¥¿ç”ºãƒ©ã‚¤ãƒ•</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f0f2f5; margin: 0; padding: 0; padding-bottom: 90px; }
        .container { padding: 15px; display: none; }
        .active { display: block; }
        .box { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 15px; }
        h3 { margin-top: 0; color: #333; font-size: 18px; text-align: center; }
        
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-blue { background: #007aff; color: white; }
        .btn-green { background: #34c759; color: white; }
        .btn-red { background: #ff3b30; color: white; }
        
        /* è²·ã„ç‰©ãƒªã‚¹ãƒˆ */
        #shopping-ul { list-style: none; padding: 0; }
        #shopping-ul li { background: #fff; border-bottom: 1px solid #eee; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .delete-btn { background: #ff3b30; color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; border: none; width: auto; margin: 0; }

        /* ãƒã‚¤ãƒ³ãƒˆ */
        .point-box { display: flex; justify-content: space-around; margin-top: 20px; }
        .point-card { text-align: center; width: 45%; padding: 10px; background: #f9f9f9; border-radius: 10px; }
        .point-num { font-size: 32px; font-weight: bold; color: #ff9500; }
        
        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ (6ã¤ç”¨) */
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #ddd; display: flex; justify-content: space-around; padding: 8px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 1000; }
        .nav-item { text-align: center; color: #888; font-size: 9px; cursor: pointer; width: 16%; }
        .nav-item.active-tab { color: #007aff; font-weight: bold; }
        .nav-icon { font-size: 18px; display: block; margin-bottom: 2px; }
        
        /* ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ */
        .radio-group { display: flex; gap: 5px; margin: 10px 0; }
        .radio-label { flex: 1; text-align: center; padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; background: #f9f9f9; font-size: 14px; }
        input[type="radio"] { display: none; }
        input[type="radio"]:checked + .radio-label { background: #e0f0ff; border-color: #007aff; color: #007aff; font-weight: bold; }
        #reader { width: 100%; border-radius: 10px; overflow: hidden; margin-bottom: 15px; background: #000; }
    </style>
</head>
<body>

    <div id="tab-scan" class="container active">
        <div class="box">
            <h3>ğŸ›’ åº•å€¤ç™»éŒ²</h3>
            <div id="reader"></div>
            <button class="btn-blue" onclick="startScan()">ğŸ“· ã‚«ãƒ¡ãƒ©èµ·å‹•</button>
            <input type="text" id="item" placeholder="å•†å“å">
            <input type="number" id="price" placeholder="ä¾¡æ ¼" inputmode="numeric">
            <input type="number" id="weight" placeholder="å†…å®¹é‡(g)" inputmode="numeric">
            <input type="text" id="store" placeholder="åº—å">
            <div id="unit-result" style="text-align:center; margin:10px 0;">å˜ä¾¡ï¼š---</div>
            <button class="btn-green" onclick="submitPrice()">ç™»éŒ²</button>
        </div>
    </div>

    <div id="tab-list" class="container">
        <div class="box">
            <h3>ğŸ“ è²·ã†ã‚‚ã®ãƒªã‚¹ãƒˆ</h3>
            <div style="display:flex; gap:5px;">
                <input type="text" id="list-input" placeholder="ç‰›ä¹³ã€æ´—å‰¤ãªã©">
                <button class="btn-blue" style="width:30%; margin:8px 0;" onclick="addListItem()">è¿½åŠ </button>
            </div>
            <ul id="shopping-ul"></ul>
        </div>
    </div>

    <div id="tab-schedule" class="container">
        <div class="box">
            <h3>ğŸ“… äºˆå®šç™»éŒ²</h3>
            <input type="text" id="event-name" placeholder="ã‚¤ãƒ™ãƒ³ãƒˆå">
            <input type="date" id="event-date">
            <div class="radio-group">
                <input type="radio" name="owner" id="naoki" value="naoki"><label for="naoki" class="radio-label">ğŸ‘¤å°šè¼</label>
                <input type="radio" name="owner" id="maki" value="maki"><label for="maki" class="radio-label">ğŸ€çœŸè¼</label>
                <input type="radio" name="owner" id="common" value="common" checked><label for="common" class="radio-label">ğŸ 2äºº</label>
            </div>
            <button class="btn-green" onclick="submitEvent()">ç™»éŒ²</button>
        </div>
    </div>

    <div id="tab-bucket" class="container">
        <div class="box">
            <h3>âœ¨ ã‚„ã‚ŠãŸã„ã“ã¨</h3>
            <p style="font-size:12px; color:#666; text-align:center;">è¡ŒããŸã„å ´æ‰€ã€é£Ÿã¹ãŸã„ã‚‚ã®...</p>
            <input type="text" id="bucket-item" placeholder="ä¾‹ï¼šåŒ—æµ·é“ã§ã‚«ãƒ‹é£Ÿã¹ã‚‹">
            <div class="radio-group">
                <input type="radio" name="bucket-owner" id="b-naoki" value="naoki"><label for="b-naoki" class="radio-label">ğŸ‘¤å°šè¼</label>
                <input type="radio" name="bucket-owner" id="b-maki" value="maki"><label for="b-maki" class="radio-label">ğŸ€çœŸè¼</label>
                <input type="radio" name="bucket-owner" id="b-common" value="common" checked><label for="b-common" class="radio-label">ğŸ 2äºº</label>
            </div>
            <button class="btn-green" onclick="submitBucket()">ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
        </div>
    </div>

    <div id="tab-pay" class="container">
        <div class="box">
            <h3>ğŸ’¸ ç«‹æ›¿è¨˜éŒ²</h3>
            <input type="text" id="pay-item" placeholder="ä½•ã«ä½¿ã£ãŸï¼Ÿ">
            <input type="number" id="pay-amount" placeholder="é‡‘é¡" inputmode="numeric">
            <div class="radio-group">
                <input type="radio" name="payer" id="pay-naoki" value="å°šè¼" checked><label for="pay-naoki" class="radio-label">ğŸ‘¤å°šè¼æ‰•</label>
                <input type="radio" name="payer" id="pay-maki" value="çœŸè¼"><label for="pay-maki" class="radio-label">ğŸ€çœŸè¼æ‰•</label>
            </div>
            <button class="btn-green" onclick="submitPayment()">è¨˜éŒ²</button>
        </div>
    </div>

    <div id="tab-love" class="container">
        <div class="box">
            <h3>â¤ï¸ æ„Ÿè¬ãƒã‚¤ãƒ³ãƒˆ</h3>
            <div style="display:flex; gap:10px;">
                <button class="btn-blue" onclick="addPoint('naoki')">ğŸ‘¤ å°šè¼ã¸</button>
                <button class="btn-red" onclick="addPoint('maki')">ğŸ€ çœŸè¼ã¸</button>
            </div>
            <div class="point-box">
                <div class="point-card">ğŸ‘¤å°šè¼<br><span id="pt-naoki" class="point-num">0</span></div>
                <div class="point-card">ğŸ€çœŸè¼<br><span id="pt-maki" class="point-num">0</span></div>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active-tab" onclick="switchTab('scan')"><span class="nav-icon">ğŸ›’</span>åº•å€¤</div>
        <div class="nav-item" onclick="switchTab('list')"><span class="nav-icon">ğŸ“</span>è²·ã†</div>
        <div class="nav-item" onclick="switchTab('schedule')"><span class="nav-icon">ğŸ“…</span>äºˆå®š</div>
        <div class="nav-item" onclick="switchTab('bucket')"><span class="nav-icon">âœ¨</span>å¤¢</div>
        <div class="nav-item" onclick="switchTab('pay')"><span class="nav-icon">ğŸ’¸</span>ç«‹æ›¿</div>
        <div class="nav-item" onclick="switchTab('love')"><span class="nav-icon">â¤ï¸</span>æ„Ÿè¬</div>
    </div>

    <script>
        // â˜…â˜…â˜…ã“ã“ã«GASã®URLã‚’è²¼ã‚‹â˜…â˜…â˜…
        const GAS_URL = "https://script.google.com/macros/s/AKfycbxRnq9CfELny2Ulv0x27ZO7-L9rp6LY52r6bcH0kW0ji0Ubr5b2VP8bC7_nNNFZV6RU/exec";

        function switchTab(tabName) {
            document.querySelectorAll('.container').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active-tab'));
            document.getElementById('tab-' + tabName).classList.add('active');
            event.currentTarget.classList.add('active-tab');
            if(tabName === 'list') loadShoppingList();
            if(tabName === 'love') loadPoints();
        }

        // 1. åº•å€¤
        const scanner = new Html5Qrcode("reader");
        function startScan() { scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (text) => { scanner.stop(); fetchItem(text); }); }
        async function fetchItem(jan) {
            const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "web_app", action: "search_jan", jan: jan }) });
            const data = await res.json(); document.getElementById('item').value = data.itemName || "";
        }
        document.getElementById('price').addEventListener('input', () => {
            const p = document.getElementById('price').value, w = document.getElementById('weight').value;
            if(p&&w) document.getElementById('unit-result').innerText = `å˜ä¾¡ï¼š${Math.round((p/w)*100)} å††`;
        });
        async function submitPrice() {
            await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "web_app", action: "register_price", item: document.getElementById('item').value, price: document.getElementById('price').value, weight: document.getElementById('weight').value, store: document.getElementById('store').value }) });
            alert("ç™»éŒ²ã—ã¾ã—ãŸï¼");
        }

        // 2. è²·ã„ç‰©ãƒªã‚¹ãƒˆ
        async function loadShoppingList() {
            const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "web_app", action: "get_shopping_list" }) });
            const data = await res.json();
            const ul = document.getElementById('shopping-ul'); ul.innerHTML = "";
            data.items.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${item}</span> <button class="delete-btn" onclick="deleteItem('${item}')">å®Œäº†</button>`;
                ul.appendChild(li);
            });
        }
        async function addListItem() {
            const item = document.getElementById('list-input').value; if(!item) return;
            await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "web_app", action: "add_shopping_item", item: item }) });
            document.getElementById('list-input').value = ""; loadShoppingList();
        }
        async function deleteItem(item) {
            if(!confirm("è²·ã„ã¾ã—ãŸã‹ï¼Ÿ")) return;
            await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "web_app", action: "delete_shopping_item", item: item }) });
            loadShoppingList();
        }

        // 3. äºˆå®š
        async function submitEvent() {
            const name = document.getElementById('event-name').value;
            const date = document.getElementById('event-date').value;
            const owner = document.querySelector('input[name="owner"]:checked').value;
            if(!name || !date) return;
            if(confirm("ç™»éŒ²ã—ã¾ã™ã‹ï¼Ÿ")) {
                await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "web_app", action: "register_event", name: name, date: date, owner: owner }) });
                alert("ç™»éŒ²å®Œäº†ï¼"); document.getElementById('event-name').value = "";
            }
        }

        // 4. ã‚„ã‚ŠãŸã„ã“ã¨ãƒªã‚¹ãƒˆ (æ–°æ©Ÿèƒ½)
        async function submitBucket() {
            const item = document.getElementById('bucket-item').value;
            const owner = document.querySelector('input[name="bucket-owner"]:checked').value;
            if(!item) return;
            if(confirm(`ã€${item}ã€‘\n\nã‚„ã‚ŠãŸã„ã“ã¨ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ`)) {
                await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "web_app", action: "register_bucket", item: item, owner: owner }) });
                alert("è¿½åŠ ã—ã¾ã—ãŸï¼âœ¨"); document.getElementById('bucket-item').value = "";
            }
        }

        // 5. ç«‹æ›¿
        async function submitPayment() {
            const item = document.getElementById('pay-item').value;
            const amount = document.getElementById('pay-amount').value;
            const payer = document.querySelector('input[name="payer"]:checked').value;
            if(!item || !amount) return;
            if(confirm(`${payer}ãŒ ${amount}å††\n(${item})\n\nè¨˜éŒ²ã—ã¾ã™ã‹ï¼Ÿ`)) {
                await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "web_app", action: "register_payment", item: item, amount: amount, payer: payer }) });
                alert("è¨˜éŒ²ã—ã¾ã—ãŸï¼"); document.getElementById('pay-item').value = ""; document.getElementById('pay-amount').value = "";
            }
        }

        // 6. ãƒã‚¤ãƒ³ãƒˆ
        async function addPoint(to) {
            if(confirm("ã€Œã‚ã‚ŠãŒã¨ã†ã€ã‚’é€ã‚Šã¾ã™ã‹ï¼Ÿ")) {
                await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "web_app", action: "add_point", to: to }) });
                alert("æ„Ÿè¬ã‚’ä¼ãˆã¾ã—ãŸï¼"); loadPoints();
            }
        }
        async function loadPoints() {
            const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "web_app", action: "get_points" }) });
            const data = await res.json();
            document.getElementById('pt-naoki').innerText = data.naoki;
            document.getElementById('pt-maki').innerText = data.maki;
        }
    </script>
</body>
</html>
